graph TB
    subgraph "cmd/ - Command-Line Applications"
        direction LR
        BS[prompt-bootstrap/main.go<br/>Bootstrap command<br/>- Parse flags<br/>- Initialize Claude<br/>- Generate variants<br/>- Output JSON]

        EVOL_CMD[prompt-evolve/main.go<br/>Evolution command<br/>- Parse config<br/>- Setup engine<br/>- Run evolution<br/>- Stream results]

        EVAL_CMD[prompt-evaluate/main.go<br/>Evaluation command<br/>- Load prompts<br/>- Run evaluator<br/>- Compare results<br/>- Generate report]

        TUI_CMD[prompt-evolve-tui/main.go<br/>Terminal UI<br/>- Real-time display<br/>- Evolution visualization<br/>- Interactive controls]
    end

    subgraph "pkg/api - Core Types"
        direction TB
        IND[Individual<br/>- Prompt: string<br/>- Fitness: float64]

        ECONF[EvolutionConfig<br/>- Generations<br/>- PopulationSize<br/>- MutationRate<br/>- CrossoverRate<br/>- SelectionPressure]

        ERES[EvolutionResult<br/>- BestPrompt<br/>- FitnessScore<br/>- Generations<br/>- TotalTime<br/>- EvolutionProgress]

        GSTATS[GenerationStats<br/>- Generation<br/>- BestFitness<br/>- AvgFitness<br/>- Diversity]

        EVALRES[EvaluationResult<br/>- Prompt<br/>- FitnessScore<br/>- Metrics map<br/>- EvaluationTime]

        IFACE_ENG[EvolutionEngine interface<br/>- Evolve()]

        IFACE_FIT[FitnessEvaluator interface<br/>- EvaluatePrompt()<br/>- GetDetailedEvaluation()]

        IFACE_POP[PopulationManager interface<br/>- Initialize()<br/>- SelectParents()<br/>- ReplacePopulation()]
    end

    subgraph "pkg/core - Unix Interfaces"
        direction TB
        IMUT[Mutator interface<br/>- Mutate()<br/>- SetStrategy()]

        IEVAL[Evaluator interface<br/>- Evaluate()<br/>- BatchEvaluate()]

        ISEL[Selector interface<br/>- Select()]

        IOBS[Observable interface<br/>- Subscribe()<br/>- Unsubscribe()]

        ISTREAM[EvolutionStream interface<br/>- Generations()<br/>- Close()]
    end

    subgraph "pkg/evolution - Evolution Engine"
        direction TB
        LLMENG[LLMEngine<br/>Main orchestrator<br/>- config<br/>- population<br/>- fitnessEval<br/>- mutator<br/>- adaptive params]

        LLMCONF[LLMEngineConfig<br/>- EvolutionConfig<br/>- LLMProvider<br/>- MutatorConfig<br/>- Adaptive flags]

        LLMENG_METHODS[Methods:<br/>- Evolve()<br/>- evolveGeneration()<br/>- selectParentsIntelligently()<br/>- generateOffspring()<br/>- performIntelligentCrossover()<br/>- performIntelligentMutation()<br/>- adaptParameters()]
    end

    subgraph "pkg/population - Population Management"
        direction TB
        POPMGR[Manager<br/>Thread-safe population<br/>- individuals<br/>- size<br/>- evaluationCount<br/>- evolutionProgress]

        POPMGR_METHODS[Methods:<br/>- Initialize()<br/>- GetIndividuals()<br/>- GetBestIndividual()<br/>- SelectParents()<br/>- ReplacePopulation()<br/>- recordGenerationStats()]

        POPUTIL[Helper functions:<br/>- createVariant()<br/>- calculateDiversity()<br/>- levenshteinDistance()]
    end

    subgraph "pkg/mutations - Genetic Operators"
        direction TB
        MUTSTRAT[MutationStrategy enum<br/>- SemanticImprovement<br/>- StyleVariation<br/>- SpecificityAdjustment<br/>- StructuralReorganization<br/>- CreativeExploration]

        MUTATOR[Mutator<br/>LLM-powered mutations<br/>- provider<br/>- temperature<br/>- maxRetries<br/>- creativityLevel]

        MUTCONF[MutatorConfig<br/>- Model<br/>- Temperature<br/>- MaxRetries<br/>- PreserveLength]

        MUTMETHODS[Methods:<br/>- Mutate()<br/>- getSystemPrompt()<br/>- buildMutationPrompt()<br/>- cleanMutationResult()]

        CROSSOVER[Crossover functions:<br/>- SelectCrossoverStrategy()<br/>- RandomCrossoverStrategy()<br/>- 4 crossover strategies]

        ADAPTIVE[Adaptive functions:<br/>- SelectMutationStrategy()<br/>- AdaptiveMutationRate()<br/>- CalculatePopulationDiversity()]
    end

    subgraph "pkg/fitness - Fitness Evaluation"
        direction TB
        FITEVAL[DefaultEvaluator<br/>Multi-criteria evaluator<br/>- config]

        FITCONF[EvaluatorConfig<br/>- Clarity weight<br/>- Specificity weight<br/>- Conciseness weight<br/>- Relevance weight<br/>- Length thresholds]

        FITMETHODS[Methods:<br/>- EvaluatePrompt()<br/>- GetDetailedEvaluation()<br/>- calculateClarity()<br/>- calculateSpecificity()<br/>- calculateConciseness()<br/>- calculateRelevance()]
    end

    subgraph "pkg/providers - LLM Providers"
        direction TB
        PROVREG[Registry<br/>Provider management<br/>- providers map]

        IPROV[Provider interface<br/>- Name()<br/>- Generate()<br/>- Models()<br/>- SetModel()<br/>- RateLimit()]

        PROVCONF[ProviderConfig<br/>- APIKey<br/>- BaseURL<br/>- Model<br/>- Temperature<br/>- MaxTokens]

        CLAUDE_IMPL[Claude provider<br/>claude/claude.go<br/>- Anthropic API<br/>- Claude 4 models]

        OPENAI_IMPL[OpenAI provider<br/>openai/openai.go<br/>- OpenAI API<br/>- GPT-4 models]

        MIDDLEWARE[Middleware<br/>- WithRetry()<br/>- WithRateLimit()<br/>- ApplyMiddleware()]
    end

    subgraph "pkg/cost - Cost Tracking"
        direction TB
        TRACKER[Tracker<br/>Token & cost tracking<br/>- totalTokens<br/>- totalCost<br/>- budget]

        PRICING[Provider pricing<br/>- Claude models<br/>- OpenAI models<br/>- Token counting]
    end

    subgraph "pkg/evaluation - LLM Evaluation"
        direction TB
        LLMEVAL[LLM-based evaluator<br/>Uses LLM as judge<br/>- provider<br/>- criteria]
    end

    subgraph "pkg/history - History Tracking"
        direction TB
        HIST[History manager<br/>Track evolution<br/>- generations<br/>- best prompts]
    end

    subgraph "pkg/tui - Terminal UI"
        direction TB
        TUITYPES[types.go<br/>UI types & state]

        TUIHAND[evolution_handler.go<br/>Evolution event handling]
    end

    subgraph "test/ - Testing Infrastructure"
        direction LR
        E2E[e2e/<br/>- evolution_pipeline_test.go<br/>- llm_evolution_test.go<br/>- real_llm_evolution_test.go]

        MOCKS[mocks/<br/>- mock_provider.go]

        FIXTURES[fixtures/<br/>- prompts.go]

        HELPERS[helpers/<br/>- test_helpers.go]
    end

    %% Component relationships
    EVOL_CMD --> LLMENG
    BS --> CLAUDE_IMPL
    EVAL_CMD --> FITEVAL
    TUI_CMD --> TUITYPES

    LLMENG --> IFACE_ENG
    LLMENG --> POPMGR
    LLMENG --> MUTATOR
    LLMENG --> FITEVAL
    LLMENG --> TRACKER

    POPMGR --> IFACE_POP
    MUTATOR --> IPROV
    FITEVAL --> IFACE_FIT

    PROVREG --> CLAUDE_IMPL
    PROVREG --> OPENAI_IMPL
    IPROV --> MIDDLEWARE

    E2E --> LLMENG
    E2E --> MOCKS

    classDef cmdClass fill:#e1f5ff,stroke:#0277bd,stroke-width:2px
    classDef typeClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef ifaceClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef implClass fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef testClass fill:#fce4ec,stroke:#880e4f,stroke-width:1px

    class BS,EVOL_CMD,EVAL_CMD,TUI_CMD cmdClass
    class IND,ECONF,ERES,GSTATS,EVALRES typeClass
    class IFACE_ENG,IFACE_FIT,IFACE_POP,IMUT,IEVAL,ISEL,IOBS,ISTREAM,IPROV ifaceClass
    class LLMENG,POPMGR,MUTATOR,FITEVAL,PROVREG,CLAUDE_IMPL,OPENAI_IMPL,TRACKER implClass
    class E2E,MOCKS,FIXTURES,HELPERS testClass
