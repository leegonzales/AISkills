graph TB
    subgraph "CLI Tools (cmd/)"
        CLI1[prompt-bootstrap<br/>Generate initial variants]
        CLI2[prompt-evolve<br/>Evolutionary optimization]
        CLI3[prompt-evaluate<br/>Fitness evaluation]
        CLI4[prompt-evolve-tui<br/>Terminal UI]
    end

    subgraph "Core Library (pkg/)"
        subgraph "Interfaces & Types"
            API[pkg/api<br/>Core types & interfaces<br/>Individual, Config, Result]
            CORE[pkg/core<br/>Unix interfaces<br/>Mutator, Evaluator, Selector]
        end

        subgraph "Evolution Engine"
            EVOL[pkg/evolution<br/>LLMEngine<br/>Genetic algorithm orchestration]
            POP[pkg/population<br/>Population Manager<br/>Selection & diversity tracking]
        end

        subgraph "Genetic Operators"
            MUT[pkg/mutations<br/>5 Mutation Strategies<br/>4 Crossover Methods<br/>LLM-powered intelligence]
        end

        subgraph "Evaluation"
            FIT[pkg/fitness<br/>Fitness Evaluator<br/>Multi-criteria scoring]
            EVAL[pkg/evaluation<br/>LLM-based evaluation]
        end

        subgraph "Infrastructure"
            PROV[pkg/providers<br/>Provider Registry<br/>Claude, OpenAI]
            COST[pkg/cost<br/>Token tracking<br/>Budget management]
            HIST[pkg/history<br/>Evolution history]
            TUI[pkg/tui<br/>Terminal UI components]
        end
    end

    subgraph "External Services"
        CLAUDE[Claude API<br/>Anthropic]
        OPENAI[OpenAI API<br/>GPT-4]
    end

    subgraph "Testing"
        TEST[test/e2e<br/>Integration tests]
        MOCK[test/mocks<br/>Mock providers]
    end

    %% CLI to Library connections
    CLI1 --> PROV
    CLI2 --> EVOL
    CLI3 --> FIT
    CLI4 --> TUI

    %% Core dependencies
    EVOL --> API
    EVOL --> CORE
    EVOL --> POP
    EVOL --> MUT
    EVOL --> FIT

    POP --> API
    MUT --> PROV
    FIT --> API
    EVAL --> PROV

    %% Infrastructure connections
    EVOL --> COST
    EVOL --> HIST
    TUI --> EVOL
    PROV --> CLAUDE
    PROV --> OPENAI

    %% Testing connections
    TEST -.-> EVOL
    TEST -.-> PROV
    MOCK -.-> PROV

    %% Data flow (main evolution pipeline)
    CLI1 ==> CLI2
    CLI2 ==> CLI3

    classDef cliClass fill:#e1f5ff,stroke:#0277bd,stroke-width:2px
    classDef coreClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef evolClass fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef infraClass fill:#e8f5e9,stroke:#388e3c,stroke-width:2px
    classDef externalClass fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef testClass fill:#fce4ec,stroke:#880e4f,stroke-width:1px,stroke-dasharray: 5 5

    class CLI1,CLI2,CLI3,CLI4 cliClass
    class API,CORE coreClass
    class EVOL,POP,MUT,FIT,EVAL evolClass
    class PROV,COST,HIST,TUI infraClass
    class CLAUDE,OPENAI externalClass
    class TEST,MOCK testClass
